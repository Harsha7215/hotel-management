{% extends "base.html" %}

{% block title %}Payment | Hotel Paradise{% endblock %}

{% block content %}
<div class="form-container">

    <h1 class="form-title">Complete Your Payment</h1>

    <!-- Booking Summary -->
    <div class="payment-info">
        <h3>Booking Summary</h3>
        <div class="payment-details">
            <div>
                <p><strong>Room:</strong>
                    {{ booking.room.room_type.name }} ({{ booking.room.room_number }})
                </p>
                <p><strong>Check-in:</strong> {{ booking.check_in_date }}</p>
                <p><strong>Check-out:</strong> {{ booking.check_out_date }}</p>
            </div>
            <div>
                <p><strong>Nights:</strong> {{ booking.nights }}</p>
                <p><strong>Guests:</strong> {{ booking.number_of_guests }}</p>
                <p class="price-highlight">
                    Total Price: ${{ booking.total_price }}
                </p>
            </div>
        </div>
    </div>

    <!-- Form Errors -->
    {% if form.non_field_errors %}
    <div class="alert alert-error">
        {{ form.non_field_errors|striptags }}
    </div>
    {% endif %}

    <form method="post" class="payment-form" novalidate>
        {% csrf_token %}

        <!-- Payment Method -->
        <div class="form-group">
            <label>
                <i class="fas fa-credit-card"></i> Select Payment Method
            </label>

            <div class="payment-methods">
                <div class="method-option selected" data-method="credit_card">
                    <i class="fas fa-credit-card fa-2x"></i>
                    <p>Credit Card</p>
                </div>

                <div class="method-option" data-method="debit_card">
                    <i class="fas fa-credit-card fa-2x"></i>
                    <p>Debit Card</p>
                </div>

                <div class="method-option" data-method="upi">
                    <i class="fas fa-mobile-alt fa-2x"></i>
                    <p>UPI</p>
                </div>

                {{ form.payment_method }}
            </div>
        </div>

        <!-- Card Details -->
        <div id="card-details">

            <div class="form-group">
                <label for="card_number">
                    <i class="fas fa-hashtag"></i> Card Number
                </label>
                <input type="text" id="card_number" name="card_number"
                       class="form-control"
                       placeholder="1234 5678 9012 3456"
                       maxlength="19">
            </div>

            <div class="form-grid">
                <div class="form-group">
                    <label for="expiry_date">
                        <i class="fas fa-calendar-alt"></i> Expiry (MM/YY)
                    </label>
                    <input type="text" id="expiry_date" name="expiry_date"
                           class="form-control"
                           placeholder="MM/YY" maxlength="5">
                </div>

                <div class="form-group">
                    <label for="cvv">
                        <i class="fas fa-lock"></i> CVV
                    </label>
                    <input type="text" id="cvv" name="cvv"
                           class="form-control"
                           placeholder="123" maxlength="3">
                </div>
            </div>

            <div class="form-group">
                <label for="card_holder">
                    <i class="fas fa-user"></i> Card Holder Name
                </label>
                <input type="text" id="card_holder" name="card_holder"
                       class="form-control"
                       placeholder="John Doe">
            </div>
        </div>

        <!-- Amount -->
        <div class="form-group">
            {{ form.amount.label_tag }}
            {{ form.amount }}
        </div>

        <!-- Actions -->
        <div class="form-actions">
            <a href="{% url 'book_room' booking.room.id %}"
               class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Back
            </a>

            <button type="submit" class="btn btn-success">
                <i class="fas fa-check-circle"></i> Complete Payment
            </button>
        </div>

    </form>
</div>

<!-- JS -->
<script>
document.addEventListener("DOMContentLoaded", function () {

    const methodOptions = document.querySelectorAll(".method-option");
    const methodInput = document.getElementById("id_payment_method");

    methodOptions.forEach(option => {
        option.addEventListener("click", () => {
            methodOptions.forEach(o => o.classList.remove("selected"));
            option.classList.add("selected");
            methodInput.value = option.dataset.method;
        });
    });

    document.getElementById("card_number").addEventListener("input", e => {
        e.target.value = e.target.value
            .replace(/\D/g, "")
            .replace(/(.{4})/g, "$1 ")
            .trim()
            .substring(0, 19);
    });

    document.getElementById("expiry_date").addEventListener("input", e => {
        let v = e.target.value.replace(/\D/g, "");
        if (v.length >= 2) v = v.slice(0, 2) + "/" + v.slice(2, 4);
        e.target.value = v.slice(0, 5);
    });

    document.getElementById("cvv").addEventListener("input", e => {
        e.target.value = e.target.value.replace(/\D/g, "").slice(0, 3);
    });
});
</script>
{% endblock %}
